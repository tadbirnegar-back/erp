<?php

namespace Modules\BDM\app\Http\Enums;

enum PermitStatusesEnum: string
{
    case first = 'تشکیل پرونده ساخت و ساز';
    case second = 'بررسی اولیه توسط مسئول فنی';
    case third = 'تایید دهیار جهت ارسال به بنیاد مسکن';
    case fourth = 'استعلام از بنیاد مسکن';
    case fifth = 'بررسی فنی استعلام بنیاد مسکن';
    case sixth = 'بررسی مالکیت زمین توسط شورای روستا';
    case seventh = 'صدور دستور تهیه نقشه ساختمانی';

    case eighth = 'معرفی مهندسین پروژه';
    case ninth = 'تهیه و تنظیم نقشه‌های معماری و سازه';
    case tenth = 'بررسی فنی نقشه‌های ساختمانی';
    case eleventh = 'ثبت تعهدات مهندسین پروژه';
    case twelfth = 'محاسبه و صدور قبض عوارض پروانه ساختمانی';

    case thirteenth = 'پرداخت عوارض پروانه ساختمانی';

    case fourteenth = 'تأییدیه پرداخت‌ها توسط مسئول مالی';
    case fifteenth = 'تأیید نهایی و صدور پروانه';
    case sixteenth = 'اجرای فونداسیون و پی‌ریزی ساختمان';
    case seventeenth = 'اجرای اسکلت و عملیات سازه‌ای';
    case eighteenth = 'اجرای عملیات سفت‌کاری و نازک‌ کاری';
    case nineteenth = 'ارائه گزارش نهایی ناظر';
    case twentieth = 'درخواست صدور گواهی پایان کار';
    case twentyfirst = 'صدور گواهی پایان کار';
    case failed = 'بررسی نقشه - رد شده';

    case rejectObligations = 'رد تعهدات';

    public function whichNumber(): string
    {
        return match ($this) {
            self::first => 'مرحله اول',
            self::second => 'مرحله دوم',
            self::third => 'مرحله سوم',
            self::fourth => 'مرحله چهارم',
            self::fifth => 'مرحله پنجم',
            self::sixth => 'مرحله ششم',
            self::seventh => 'مرحله هفتم',
            self::eighth => 'مرحله هشتم',
            self::ninth => 'مرحله نهم',
            self::tenth => 'مرحله دهم',
            self::eleventh => 'مرحله یازدهم',
            self::twelfth => 'مرحله دوازدهم',
            self::thirteenth => 'مرحله سیزدهم',
            self::fourteenth => 'مرحله چهاردهم',
            self::fifteenth => 'مرحله پانزدهم',
            self::sixteenth => 'مرحله شانزدهم',
            self::seventeenth => 'مرحله هفدهم',
            self::eighteenth => 'مرحله هجدهم',
            self::nineteenth => 'مرحله نوزدهم',
            self::twentieth => 'مرحله بیستم',
            self::twentyfirst => 'مرحله بیست و یکم',
            self::failed => 'مرحله نهم',
            self::rejectObligations => 'مرحله یازدهم',
        };


    }

    public function id(): int
    {
        return match ($this) {
            self::first => 1,
            self::second => 2,
            self::third => 3,
            self::fourth => 4,
            self::fifth => 5,
            self::sixth => 6,
            self::seventh => 7,
            self::eighth => 8,
            self::ninth => 9,
            self::tenth => 10,
            self::eleventh => 11,
            self::twelfth => 12,
            self::thirteenth => 13,
            self::fourteenth => 14,
            self::fifteenth => 15,
            self::sixteenth => 16,
            self::seventeenth => 17,
            self::eighteenth => 18,
            self::nineteenth => 19,
            self::twentieth => 20,
            self::twentyfirst => 21,
            self::failed => 22,
            self::rejectObligations => 23,
        };
    }


    public function description(): string
    {
        return match ($this) {
            self::first => "در این مرحله، مسئول فنی اطلاعات ثبت‌شده توسط متقاضی را بررسی می‌کند؛ در صورت نیاز با کمک دهیار یا خود متقاضی آن‌ها را اصلاح می‌کند.",
            self::second => "در این مرحله، مسئول فنی اطلاعات ثبت‌شده توسط متقاضی را بررسی می‌کند؛ در صورت نیاز با کمک دهیار یا خود متقاضی آن‌ها را اصلاح می‌کند.",
            self::third => "در این مرحله، دهیار «فرم شماره ۱ - استعلام بنیاد مسکن» را که توسط مسئول فنی بررسی و تنظیم شده، مطالعه کرده و در صورت تأیید، آن را امضا می‌کند. با این تأیید، فرم برای بارگذاری و ارسال به سامانه راهبر بنیاد مسکن آماده می‌شود.",
            self::fourth => "در این مرحله، دهیار «فرم شماره ۱ - استعلام بنیاد مسکن» را که توسط مسئول فنی بررسی و تنظیم شده، مطالعه کرده و در صورت تأیید، آن را امضا می‌کند. با این تأیید، فرم برای بارگذاری و ارسال به سامانه راهبر بنیاد مسکن آماده می‌شود.",
            self::fifth => "در این مرحله، مسئول فنی موظف است نتیجه استعلام بنیاد مسکن که توسط متقاضی در قالب «فرم شماره الف ۲-۱» در سامانه بارگذاری شده، بررسی کند. سپس با انتخاب گزینه «تکمیل اطلاعات»، باید اطلاعات فنی مورد نیاز را ثبت نماید.  پس از ثبت این اطلاعات، «فرم شماره ۲ - تقاضای صدور پروانه ساختمانی» و «فرم شماره ۳ - نامه گواهی مالکیت زمین» به‌صورت خودکار در سامانه ایجاد و قابل دانلود خواهند بود.",
            self::sixth => "در این مرحله، متقاضی باید «فرم شماره ۳ - نامه گواهی مالکیت زمین» را که در مرحله ۵ به‌صورت خودکار در سامانه ایجاد شده، دانلود و چاپ کرده و برای تأیید به شورای روستا ارائه دهد. پس از تأیید شورا، متقاضی موظف است فرم امضا شده را در سامانه بارگذاری کند تا فرآیند صدور پروانه ادامه یابد.",
            self::seventh => "در این مرحله، دهیار «فرم شماره ۴ - نامه دستور تهیه نقشه» را تأیید و امضا می‌کند. این دستور به منزله صدور مجوز رسمی برای آغاز فرآیند تهیه نقشه‌های ساختمانی بوده و ادامه کار را به مرحله طراحی فنی وارد می‌کند.",
            self::eighth => "در این مرحله، متقاضی پیامی مبنی بر لزوم معرفی مهندسین فنی پروژه دریافت می‌کند. متقاضی باید با در دست داشتن «فرم شماره ۴ - دستور تهیه نقشه» به دفتر فنی مهندسی مراجعه کرده و فرایند معرفی مهندسین طراح، ناظر و محاسب را آغاز نماید.  مهندسین مورد نظر باید در سامانه ثبت‌نام کنند و پس از هماهنگی با مسئول فنی، پرونده ساختمان جهت تهیه نقشه به آن‌ها واگذار می‌شود. پس از واگذاری، کلیه اطلاعات مربوط به پروژه در اختیار مهندسین قرار می‌گیرد تا فرآیند ترسیم نقشه آغاز شود.",
            self::ninth => "در این مرحله، مهندسین پروژه پس از طراحی نقشه‌های معماری، سازه و سایر نقشه‌های فنی مورد نیاز، موظف‌اند فایل‌های نهایی را در سامانه بارگذاری کنند. بارگذاری این نقشه‌ها شرط لازم برای آغاز مرحله بررسی و تأیید توسط مرجع فنی است.",
            self::tenth => "در این مرحله، مسئول فنی نقشه‌های معماری و سازه را از نظر انطباق با دستورالعمل‌ها و مقررات فنی بررسی می‌کند. در صورت وجود مغایرت، با انتخاب گزینه «رد»، توضیحات لازم را ثبت کرده و از مهندسین پروژه می‌خواهد تا اصلاحات مورد نیاز را اعمال کرده و نقشه‌های اصلاح‌شده را مجدداً بارگذاری کنند.  در صورت تأیید نقشه‌ها، مسئول فنی با انتخاب گزینه «تأیید و تکمیل»، وارد مرحله ثبت اطلاعات استخراج‌شده از نقشه‌ها می‌شود و این اطلاعات را برای تکمیل پرونده ساختمانی در فرم مربوطه وارد می‌نماید. پس از تکمیل این مرحله، پیش‌نویس فرم‌های زیر به‌صورت خودکار در سامانه تولید و قابل دانلود خواهد بود:
فرم ۵: برگ تعهد معمار
فرم ۶: برگ تعهد محاسبات سازه
فرم ۷: برگ تعهد نظارت
فرم ۸: اعلام شروع به کار عملیات ساختمانی
فرم ۶: برگ تعهد محاسبات سازه
فرم ۷: برگ تعهد نظارت
فرم ۸: اعلام شروع به کار عملیات ساختمانی ",
            self::eleventh => "در این مرحله، با تأیید نهایی نقشه‌ها توسط مسئول فنی در مرحله قبل، پروژه آماده آغاز عملیات اجرایی است. اکنون مهندسین پروژه باید فرم‌های تعهد که در مرحله ۱۰ به‌صورت خودکار در سامانه ایجاد شده‌اند را دانلود، امضا و در سامانه بارگذاری کنند.  فرم‌های مورد نیاز شامل «فرم ۵: برگ تعهد معماری»، «فرم ۶: برگ تعهد محاسبات سازه»، «فرم ۷: برگ تعهد نظارت» و «فرم ۸: اعلام شروع به کار عملیات ساختمانی» هستند.  با بارگذاری این فرم‌ها، پرونده آماده ورود به مرحله صدور پروانه ساخت خواهد بود.",
            self::twelfth => "در این مرحله، مسئول فنی اطلاعات مربوط به محاسبه عوارض ساخت را در فرم ویژه‌ای که در سامانه باز می‌شود وارد می‌کند. پس از تکمیل این اطلاعات، سامانه به‌صورت خودکار مبلغ عوارض را محاسبه کرده و پس از ثبت نهایی، قبض عوارض پروانه ساختمانی صادر می‌گردد.",
            self::thirteenth => "در این مرحله، متقاضی باید عوارض صادرشده را از طریق یکی از روش‌های پرداخت موجود و مورد تأیید سامانه پرداخت نماید. پس از پرداخت، متقاضی موظف است رسید پرداخت را در سامانه بارگذاری کند یا آن را به مسئول فنی تحویل دهد تا وی اقدام به بارگذاری آن نماید. با ثبت رسید، پرونده آماده ورود به مرحله بعدی می‌شود.",
            self::fourteenth => "در این مرحله، مسئول مالی رسید مربوط به پرداخت عوارض را بررسی و در صورت صحت، آن را تأیید می‌کند تا اسناد مالی مربوطه در سامانه ثبت و نهایی شوند. با انجام این تأیید، پرونده از نظر مالی تکمیل شده و آماده صدور پروانه ساختمانی خواهد بود.",
            self::fifteenth => "در این مرحله، تمامی فرآیندهای فنی، اداری و مالی به پایان رسیده و پرونده آماده صدور پروانه است. دهیار با بررسی نهایی و تأیید پرونده، اقدام به صدور پروانه ساختمانی می‌نماید. پس از صدور، پیام اطلاع‌رسانی برای متقاضی ارسال می‌شود و نسخه پروانه در سامانه قابل دسترسی خواهد بود.",
            self::sixteenth => "در این مرحله، عملیات اجرایی پروژه وارد فاز اجرای فونداسیون و پی‌ریزی می‌شود. پس از اتمام این مرحله، مهندس ناظر موظف است گزارش اتمام عملیات فونداسیون را در سامانه ثبت کند تا امکان ادامه فرآیند و ورود به مرحله بعدی فراهم گردد.",
            self::seventeenth => "در این مرحله، پروژه وارد فاز اجرای اسکلت و عملیات سازه‌ای می‌شود. پس از اتمام این بخش از ساخت‌وساز، مهندس ناظر باید گزارش پایان اجرای اسکلت را در سامانه ثبت کند تا پروژه وارد مرحله بعدی گردد.",
            self::eighteenth => "در این مرحله، پروژه وارد فاز اجرای سفت‌کاری و نازک‌کاری می‌شود. با اتمام این عملیات، مهندس ناظر موظف است گزارش پایان این مرحله را در سامانه ثبت کند تا مسیر برای بررسی نهایی و صدور پایان کار هموار شود.",
            self::nineteenth => "در این مرحله، پروژه باید به‌طور کامل به پایان رسیده باشد. مهندس ناظر موظف است گزارش نهایی خود را مبنی بر اتمام کلیه عملیات اجرایی در سامانه ثبت کند. ثبت این گزارش شرط لازم برای آماده شدن پرونده جهت درخواست صدور گواهی پایان کار است.",
            self::twentieth => "در این مرحله، مسئول فنی موظف است تمامی اطلاعات پرونده را یک‌بار دیگر به‌صورت کامل بررسی کرده و پس از اطمینان از اتمام تمامی مراحل فنی و اجرایی، گزینه «تأیید و درخواست صدور» را در سامانه انتخاب کند.  با این اقدام، «فرم شماره ۳ - درخواست صدور گواهی پایان کار» به‌صورت خودکار در سامانه ایجاد شده و برای تأیید نهایی به دهیار ارجاع داده می‌شود.",
            self::twentyfirst => "در این آخرین مرحله، دهیار پس از بررسی نهایی، گواهی پایان کار را تأیید و صادر می‌نماید. با ثبت این تأیید، گواهی پایان کار به‌صورت رسمی برای متقاضی صادر شده و پیامک اطلاع‌رسانی صدور گواهی نیز برای وی ارسال می‌گردد.",
            self::failed => 22,
            self::rejectObligations => 23,
        };
    }

    public static function listWithIds(): array
    {
        return array_map(
            fn($case) => [
                'id' => $case->id(),
                'name' => $case->value,
            ],
            array_filter(self::cases(), fn($case) => $case->value != self::failed->value)
        );
    }

    public static function whichNumberStatic(string $value): ?string
    {
        if ($value != self::failed->value && $value != self::rejectObligations->value) {
            foreach (self::cases() as $case) {
                if ($case->value === $value) {
                    return $case->whichNumber();
                }
            }
        }


        return null; // or throw an exception if preferred
    }

    public static function getDescriptionByName(string $value): ?string
    {
        foreach (self::cases() as $case) {
            if ($case->value === $value) {
                return $case->description();
            }
        }

        return null; // or throw new \InvalidArgumentException("Invalid status name");
    }
}
